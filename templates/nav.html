<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Навигация по музею</title>
    <link rel="stylesheet" href="../static/styles/styles.css">
</head>
<body>
    <header class="header">
        <h1>Навигация по музею</h1>
    </header>

    <main class="main-content">
        <section class="qr-section">
            <h2>Сканируйте QR-код</h2>
            <video id="camera" autoplay></video>
            <button id="capture">Сделать снимок</button>
            <canvas id="canvas" style="display:none;"></canvas>
            <p id="current-hall">Вы находитесь в: <span id="hall-name">—</span></p>
        </section>

        <section class="navigation-section">
            <h2>Выберите зал</h2>
            <select id="hall-select">
                <option value="">Выберите зал...</option>
            </select>
            <button id="findRoute">Показать маршрут</button>
            <p id="shortest-path"></p>
        </section>
    </main>

    <script>
        const video = document.getElementById('camera');
        const canvas = document.getElementById('canvas');
        const captureButton = document.getElementById('capture');
        const hallName = document.getElementById('hall-name');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => video.srcObject = stream)
            .catch(error => console.error("Ошибка доступа к камере", error));

        captureButton.addEventListener('click', () => {
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('image', blob, 'qr-code.jpg');
                
                fetch('/scan_qr', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => hallName.textContent = data.hall || "Не удалось распознать QR-код")
                .catch(error => console.error("Ошибка при отправке изображения", error));
            }, 'image/jpeg');
        });
    </script>
</body>
</html>
